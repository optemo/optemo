<%# Cache specs here at the top of navbox partial to save on SQL calls and instantiations. Don't bother with Bin or Text specs since they are only used once each (though this might change in future, be careful) %>
<% cont_specs = ContSpec.cache_all(product.id); cat_specs = CatSpec.cache_all(product.id); %>
<div id="box<%= product.id %>" class="navbox" <%= ("style='margin-right:0px;background:none;'" if i % (Float(@s.numGroups)/3).ceil == (Float(@s.numGroups)/3).ceil - 1) %>>
	<div class="topbar">
		<%= image_tag(cat_specs["img150url"], :class => "productimg", :alt => cat_specs["title#{fr?}"], :title => t('products.compare.clickforspecs'), :'data-id' => product.id, :'data-sku' => product.sku) %>


		<div class="productinfo">
      <% if !landing %>
      <div class="productspecs">
      		  <input type="checkbox"
			       data-sku="<%= product.sku %>"
			       class="optemo_compare_checkbox" />
		        <a class="regular_reset optemo_compare_button" style="" href="#" title="<%=t('products.compare.clickforcompare')%>">
		    <span><%=t('products.compare.compare')%></span>
		  </a>
      </div>
      <% end %>
			<%= link_to cat_specs["title#{fr?}"], TextSpec.cacheone(product.id, "productUrl#{fr?}"), :'data-id' => product.id, :'data-sku' => product.sku, :class => "easylink", :title => t('products.compare.clickforspecs') %>
		    
						
			<div class="productspecs"><!--&--></div>
			
			<% if BinSpec.cache_all(product.id)["onsale"] %>
				<div class="saleprice">
				<%= t('products.compare.onsale')+(fr?.empty? ? "" : " ")+": "+number_to_currency(cont_specs["saleprice"]) %></div>	
				<div class="save"><%= t('products.compare.save')+(fr?.empty? ? "" : " ")+": "+ number_to_currency(cont_specs["price"]-cont_specs["saleprice"]) %></div>
			    <div class="saleends"><%= t('products.show.saleends')+(fr?.empty? ? "" : " ")+": "%><%= l((Date.parse(cat_specs["saleEndDate"]) - 1.day), :format => :long) if cat_specs["saleEndDate"] %></div>
			<% else %>
				<div class="price">
					<%= t('products.show.ourprice') + ":"%> <%= "$" if fr?.empty? %><%= number_with_delimiter(cont_specs["price"]) %> <%= " $" unless fr?.empty? %>
				</div>	
			<% end %>
			<% if cont_specs["customerRating"] > 0 %>
				<div class="stars" data-stars="<%= cont_specs["customerRating"] %>"></div>
			<% end %>
		</div>
		<!-- Show small images and links for each sibling of this product  -->
		<% siblings = product.product_siblings -%>
		<% bundles = product.product_bundles -%>
		<% unless siblings.empty? && bundles.empty? %>
		<div class="siblingsbox">
			<div class="siblingslabel"><%=raw siblingslabel(siblings,bundles) %></div>
			<% (siblings+bundles).each do |sibling| -%> 
			  <% sibling_id = sibling.is_a?(ProductSibling) ? sibling.sibling_id : sibling.bundle_id -%>
				<% sibling_cat_specs = CatSpec.cache_all(sibling_id) -%>
				<% sibling_cont_specs = ContSpec.cache_all(sibling_id) -%>
        <div class="siblingdiv">
				<% link_to TextSpec.cacheone(sibling_id, "productUrl#{fr?}"), :'data-id' => sibling_id, :class => "sibling", :title => sibling.is_a?(ProductSibling) ? sibling_cat_specs["color#{fr?}"] : sibling_cat_specs["title#{fr?}"] do %>
				  <%= image_tag(sibling_cat_specs["imgsurl"], :alt => sibling_cat_specs["color#{fr?}"]) %>
				  <div class="pricediff"><%= "+"+number_to_currency(sibling_cont_specs["saleprice"]-cont_specs["saleprice"], precision: 0) if sibling_cont_specs["saleprice"] != cont_specs["saleprice"] %></div>
				<% end %>
        </div>
			<% end %>
			<div style="clear:left"><!-- --></div>
		</div>
		<% end %>
	     
	</div>
	<div style="text-align:left; padding-left:20px">
			<div class="spacer buttons"><%= link_to image_tag("bestbuy_addtocart#{fr?}.gif"), "http://www.bestbuy.ca/order/addtocart.ashx?accessories=#{product.sku}", {:'data-sku' => product.sku, :class => 'addtocart'} %></div>
	</div>

</div>
