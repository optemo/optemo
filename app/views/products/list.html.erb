<% self.full_title = 'LaserPrinterHub - Find Laser Printers, Compare Prices, then Buy' %>
<div id="leftbar">
	Browsing <%= @s.result_count %> <%= @pt.pluralize.capitalize %>
	<% if RAILS_ENV == 'development' %>Session id: <%= session[:user_id] %> <% end %>
	<!-- The Search box -->
	<% form_tag ("/search/find/#{@s.to_s}") do %>
	  <%= text_field_tag 'search' %>
	  <%= submit_tag 'Search', {:id => 'submit_button'} %>
	  <% end %>

	<!-- The Saved Items box -->
	<div id="savebar">
		<h2>Saved Items</h2>
		<div id="savebar_content">
		<p id="already_added_msg" style="display:none">You already added that product!</p>
		<p id="deleteme"
			<% if @picked_products.empty? %> style="display:block" 
			<% else %> style="display:none" <% end %>
			> Save some products to add them to this list</p>
		<% if (@picked_products.empty? == false) %>
		  <%= render :partial => 'product', :collection => @picked_products%>
		<% end %>
		</div>
		<!-- Hide if 0 products, show if 1/more. -->
		<div style = "clear: both;"> <a id="compare_button" 
			<%if @picked_products.empty? %> style="display:none" 
			<% else %> style="display:block" <% end %> 
		 href='/compare'>Compare them!</a></div>
	</div>

<!-- The Filters section -->
<div id="filterbar">
	<h2>Filters</h2>
	<% form_tag("/search/filter/#{@s.to_s}",{:id => 'filter_form'}) do %>
		<!-- Filter partial to draw the filter controls -->
	  	<%= render :partial => 'filter' %>
	  	<br>
	<% end %>
</div>

<div id="preferenceBar">
	<h2>Preferences</h2>
	<% form_tag("/search/preference/#{@c.to_s}",{:id => 'preference_form'}) do %>
		<!-- Preference partial to draw the preference controls -->
	  	<%= render :partial => 'preference' %>
	  	<br>
	<% end %>
</div>

</div>

<div class="main">
	<span style="color:red;"><%= flash[:error] %></span>
	
	<!-- count variable to print << after every Go Back link -->
	<% count=1 %>	
	<div class='backlink'>
	<% history(@pt).each do |s| %>
 	  <!-- If s>1 then print << -->
	  <% if count>1 %>
		&nbsp;&nbsp;&lt;&lt;
	  <% end %>   
	  <%= link_to "Go back to previous #{@pt.pluralize}", :action => 'list', :id => s.id%>
	  <% count = count+1 %>
	<% end %>
	</div>
	
	<% for i in 0..@s.cluster_count-1 %>
	  <% if i%3 == 0 %>
		<div class="rowdiv">
		<% open = true %>
	  <% end %>
	  <!-- Navbox partial to draw boxes -->
	  <%= render :partial => 'navbox', :locals => {:i => i, :cluster => @s.clusters[i]} %>
	  <% if i%3 == 2 %>
		</div>
		<% open = false %>
	  <% end %>
	<% end %>
	<%= '</div>' if open %>
	<!--<div class="easynav" style="display:none;">
	  <div class="buttons"><%= link_to 'Higher Resolution' %><%= link_to 'Lower Price' %><%= link_to 'Bigger Display Size' %><%= link_to 'Farther Zoom' %></div>
	  <div class="cont">
		<%= link_to 'Show More products' %>
	  </div>
	</div>-->
</div>

<% content_for :header do %>
	<% if @product %>
		<div style="float:left">Viewing<br><%= @result_count %> Similar<br>products to:</div>
		<%= render :partial => 'product', :locals => {:nox => true, :product => @product} %>
		<%# @session.msg %>
	<% end %>
<% end %>